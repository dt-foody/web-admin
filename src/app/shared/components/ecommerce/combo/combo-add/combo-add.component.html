<div class="space-y-6">
  <!-- Combo Info Section -->
  <div
    class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"
  >
    <div class="border-b border-gray-200 px-6 py-4 dark:border-gray-800">
      <h2 class="text-lg font-medium text-gray-800 dark:text-white">Combo Information</h2>
    </div>
    <div class="p-4 sm:p-6">
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Image Upload Column - Left Side -->
        <div class="lg:col-span-3">
          <app-label>Combo Thumbnail</app-label>
          <div class="mt-2">
            <app-image-upload [imagePreview]="imagePreview" (fileSelected)="onFileSelected($event)">
            </app-image-upload>
          </div>
        </div>

        <!-- Form Fields Column - Right Side -->
        <div class="lg:col-span-9">
          <div class="grid grid-cols-1 gap-5">
            <!-- Combo Name -->
            <div>
              <app-label for="combo-name" className="required">Combo Name</app-label>
              <app-input-field
                id="combo-name"
                placeholder="Enter combo name (e.g., Morning Breakfast Deal)"
                [(value)]="comboData.name"
              >
              </app-input-field>
            </div>

            <!-- Status & Priority -->
            <div class="grid grid-cols-1 gap-5 md:grid-cols-2">
              <div>
                <app-label for="status">Status</app-label>
                <app-select
                  id="status"
                  [options]="availabilityOptions"
                  placeholder="Select status"
                  [value]="comboData.isActive.toString()"
                  (valueChange)="handleSelectChange('isActive', $event)"
                >
                </app-select>
              </div>
              <div>
                <app-label for="priority">Display Priority</app-label>
                <app-input-field
                  id="priority"
                  type="number"
                  placeholder="0"
                  [(value)]="comboData.priority"
                >
                </app-input-field>
              </div>
            </div>

            <!-- Date Range -->
            <div class="grid grid-cols-1 gap-5 md:grid-cols-2">
              <div>
                <app-label for="start-date" className="required">Start Date</app-label>
                <app-input-field id="start-date" type="date" [(value)]="comboData.startDate">
                </app-input-field>
              </div>
              <div>
                <app-label for="end-date" className="required">End Date</app-label>
                <app-input-field id="end-date" type="date" [(value)]="comboData.endDate">
                </app-input-field>
              </div>
            </div>

            <!-- Combo Price -->
            <div>
              <app-label for="combo-price" className="required">Combo Price</app-label>
              <div class="relative">
                <app-input-field
                  id="combo-price"
                  type="number"
                  placeholder="0.00"
                  [(value)]="comboData.comboPrice"
                >
                </app-input-field>
                <div class="mt-2 flex items-center justify-between text-sm">
                  <span class="text-gray-500 dark:text-gray-400">
                    Total value of items: {{ calculateTotalValue() | number: '1.0-0' }} VND
                  </span>
                  <span
                    class="font-medium"
                    [class.text-green-600]="comboData.comboPrice < calculateTotalValue()"
                    [class.text-red-600]="comboData.comboPrice >= calculateTotalValue()"
                  >
                    Discount:
                    {{ calculateTotalValue() - comboData.comboPrice | number: '1.0-0' }} VND ({{
                      ((calculateTotalValue() - comboData.comboPrice) / calculateTotalValue()) * 100
                        | number: '1.0-0'
                    }}%)
                  </span>
                </div>
              </div>
            </div>

            <!-- Description -->
            <div>
              <app-label for="description">Description</app-label>
              <app-text-area
                id="description"
                [rows]="4"
                placeholder="Enter combo description"
                [(value)]="comboData.description"
              >
              </app-text-area>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Combo Items Section -->
  <div
    class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"
  >
    <div class="border-b border-gray-200 px-6 py-4 dark:border-gray-800">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-lg font-medium text-gray-800 dark:text-white">Combo Items</h2>
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
            Define slots and selectable products for each position in the combo
          </p>
        </div>
        <app-button variant="outline" size="sm" (btnClick)="addComboItem()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="mr-1.5"
          >
            <path d="M12 5v14M5 12h14" />
          </svg>
          Add Item Slot
        </app-button>
      </div>
    </div>
    <div class="p-4 sm:p-6">
      <div class="space-y-4">
        <!-- Empty State -->
        <div
          *ngIf="comboData.items.length === 0"
          class="rounded-lg border-2 border-dashed border-gray-300 p-12 text-center dark:border-gray-700"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="mx-auto mb-4 text-gray-400"
          >
            <rect x="3" y="3" width="7" height="7" />
            <rect x="14" y="3" width="7" height="7" />
            <rect x="14" y="14" width="7" height="7" />
            <rect x="3" y="14" width="7" height="7" />
          </svg>
          <p class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">No items yet</p>
          <p class="mb-4 text-xs text-gray-500 dark:text-gray-400">
            Add item slots like Drink, Food, Dessert, etc.
          </p>
          <app-button variant="primary" size="sm" (btnClick)="addComboItem()"
            >Add First Item</app-button
          >
        </div>

        <!-- Combo Items List -->
        <div
          *ngFor="let item of comboData.items; let itemIndex = index"
          class="rounded-lg border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-900/50"
        >
          <!-- Item Header -->
          <div
            class="flex items-center justify-between border-b border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800/50"
          >
            <div class="flex items-center gap-3">
              <button
                (click)="toggleItem(itemIndex)"
                class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  [class.rotate-90]="isItemExpanded(itemIndex)"
                  class="transition-transform"
                >
                  <path d="M9 18l6-6-6-6" />
                </svg>
              </button>
              <div>
                <h3 class="font-medium text-gray-800 dark:text-white">
                  {{ item.slotName || 'Unnamed Slot ' + (itemIndex + 1) }}
                </h3>
                <p class="text-xs text-gray-500 dark:text-gray-400">
                  {{ item.selectableProducts.length }} product(s) |
                  {{ item.isRequired ? 'Required' : 'Optional' }}
                </p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <!-- Move Up -->
              <button
                *ngIf="itemIndex > 0"
                (click)="moveItemUp(itemIndex)"
                class="rounded p-1.5 text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M18 15l-6-6-6 6" />
                </svg>
              </button>
              <!-- Move Down -->
              <button
                *ngIf="itemIndex < comboData.items.length - 1"
                (click)="moveItemDown(itemIndex)"
                class="rounded p-1.5 text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-300"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M6 9l6 6 6-6" />
                </svg>
              </button>
              <!-- Delete -->
              <button
                (click)="removeComboItem(itemIndex)"
                class="rounded p-1.5 text-red-500 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                  />
                </svg>
              </button>
            </div>
          </div>

          <!-- Item Content (Expandable) -->
          <div *ngIf="isItemExpanded(itemIndex)" class="p-4 space-y-4">
            <!-- Item Settings -->
            <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
              <div class="md:col-span-2">
                <app-label [for]="'slot-name-' + itemIndex" className="required"
                  >Slot Name</app-label
                >
                <app-input-field
                  [id]="'slot-name-' + itemIndex"
                  placeholder="e.g., Main Drink, Side Dish"
                  [(value)]="item.slotName"
                >
                </app-input-field>
              </div>
              <div class="flex items-end">
                <label class="inline-flex items-center gap-2">
                  <input
                    type="checkbox"
                    [checked]="item.isRequired"
                    (change)="
                      handleItemFieldChange(itemIndex, 'isRequired', $any($event.target).checked)
                    "
                    class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700"
                  />
                  <span class="text-sm font-medium text-gray-700 dark:text-gray-300"
                    >Required Selection</span
                  >
                </label>
              </div>
            </div>

            <!-- Selectable Products List -->
            <div class="space-y-3">
              <div class="flex items-center justify-between">
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300"
                  >Selectable Products</label
                >
                <button
                  (click)="addSelectableProduct(itemIndex)"
                  class="inline-flex items-center gap-1.5 rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M12 5v14M5 12h14" />
                  </svg>
                  Add Product
                </button>
              </div>

              <!-- Empty Products State -->
              <div
                *ngIf="item.selectableProducts.length === 0"
                class="rounded-lg border border-dashed border-gray-300 p-6 text-center dark:border-gray-600"
              >
                <p class="text-sm text-gray-500 dark:text-gray-400">No products added yet</p>
              </div>

              <!-- Products -->
              <div
                *ngFor="let product of item.selectableProducts; let productIndex = index"
                class="grid grid-cols-1 gap-3 rounded-lg border border-gray-200 bg-white p-3 dark:border-gray-600 dark:bg-gray-800 md:grid-cols-12"
              >
                <div class="md:col-span-5">
                  <app-label
                    [for]="'product-' + itemIndex + '-' + productIndex"
                    class="text-xs"
                    className="required"
                    >Product</app-label
                  >
                  <app-select
                    [id]="'product-' + itemIndex + '-' + productIndex"
                    [options]="getProductOptions()"
                    placeholder="Select product"
                    [(value)]="product.product"
                  >
                  </app-select>
                </div>

                <div class="md:col-span-3">
                  <app-label
                    [for]="'fixed-price-' + itemIndex + '-' + productIndex"
                    class="text-xs"
                    className="required"
                    >Fixed Price (VND)</app-label
                  >
                  <app-input-field
                    [id]="'fixed-price-' + itemIndex + '-' + productIndex"
                    type="number"
                    placeholder="0"
                    [(value)]="product.fixedPrice"
                  >
                  </app-input-field>
                </div>

                <div class="md:col-span-3">
                  <app-label [for]="'max-qty-' + itemIndex + '-' + productIndex" class="text-xs"
                    >Max Quantity</app-label
                  >
                  <app-input-field
                    [id]="'max-qty-' + itemIndex + '-' + productIndex"
                    type="number"
                    placeholder="1"
                    [(value)]="product.maxQuantity"
                  >
                  </app-input-field>
                </div>

                <div class="flex items-end md:col-span-1">
                  <button
                    (click)="removeSelectableProduct(itemIndex, productIndex)"
                    class="rounded p-1.5 text-red-500 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M18 6L6 18M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="flex flex-col gap-3 sm:flex-row sm:justify-end">
    <app-button size="sm" variant="primary" (btnClick)="onPublish()">
      {{ isEditMode ? 'Update Combo' : 'Publish Combo' }}
    </app-button>
  </div>
</div>
