<div class="flex flex-col h-full">
  <div class="p-4 border-b border-gray-200 dark:border-gray-700">
    <div class="">
      <input type="text" placeholder="Tìm sản phẩm hoặc combo..."
        class="w-full px-4 py-2 border border-gray-300 rounded-lg dark:bg-gray-800 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-brand-500"
        [value]="searchTerm" (input)="onSearch($event)" />
    </div>
  </div>

  <div class="flex-1 overflow-y-auto">
    <div class="flex h-full">

      <div class="w-1/4 h-full overflow-y-auto border-r border-gray-200 dark:border-gray-700">
        <nav class="flex flex-col p-2 space-y-1">

          <button type="button" class="w-full px-3 py-2 text-left rounded-md text-sm font-medium transition-colors"
            [class.bg-brand-50]="selectedCategoryId === 'all'" [class.text-brand-700]="selectedCategoryId === 'all'"
            [class.dark:bg-gray-800]="selectedCategoryId === 'all'" [class.text-gray-600]="selectedCategoryId !== 'all'"
            [class.dark:text-gray-300]="selectedCategoryId !== 'all'"
            [class.hover:bg-gray-50]="selectedCategoryId !== 'all'"
            [class.dark:hover:bg-gray-800]="selectedCategoryId !== 'all'" (click)="onSelectCategory('all')">
            Tất cả
          </button>

          <button type="button" class="w-full px-3 py-2 text-left rounded-md text-sm font-medium transition-colors"
            [class.bg-brand-50]="selectedCategoryId === 'combo'" [class.text-brand-700]="selectedCategoryId === 'combo'"
            [class.dark:bg-gray-800]="selectedCategoryId === 'combo'"
            [class.text-gray-600]="selectedCategoryId !== 'combo'"
            [class.dark:text-gray-300]="selectedCategoryId !== 'combo'"
            [class.hover:bg-gray-50]="selectedCategoryId !== 'combo'"
            [class.dark:hover:bg-gray-800]="selectedCategoryId !== 'combo'" (click)="onSelectCategory('combo')">
            Combos
          </button>

          <div class="my-1 border-t border-gray-100 dark:border-gray-700"></div>

          @for (cat of categories; track cat.id) {
          <button type="button"
            class="w-full px-3 py-2 text-left rounded-md text-sm font-medium truncate transition-colors"
            [class.bg-brand-50]="selectedCategoryId === cat.id" [class.text-brand-700]="selectedCategoryId === cat.id"
            [class.dark:bg-gray-800]="selectedCategoryId === cat.id"
            [class.text-gray-600]="selectedCategoryId !== cat.id"
            [class.dark:text-gray-300]="selectedCategoryId !== cat.id"
            [class.hover:bg-gray-50]="selectedCategoryId !== cat.id"
            [class.dark:hover:bg-gray-800]="selectedCategoryId !== cat.id" (click)="onSelectCategory(cat.id)">
            {{ cat.name }}
          </button>
          }
        </nav>
      </div>

      <div class="w-3/4 h-full p-4 overflow-y-auto bg-gray-50 dark:bg-gray-900/50">

        @if (selectedCategoryId === 'combo') {
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          @for (combo of filteredCombos; track combo.id) {
          <button type="button"
            class="flex flex-col items-center justify-between p-3 text-center rounded-lg shadow bg-white dark:bg-gray-800 hover:shadow-md hover:scale-[1.02] transition-all duration-150 border border-transparent hover:border-brand-200"
            (click)="onComboClick(combo)">
            <div class="w-full h-24 mb-2 bg-gray-100 rounded dark:bg-gray-700 overflow-hidden">
              @if (combo.image) {
              <img [src]="combo.image" [alt]="combo.name" class="w-full h-full object-cover" />
              } @else {
              <div class="flex items-center justify-center w-full h-full text-gray-400">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M5 11v2m14-2v2">
                  </path>
                </svg>
              </div>
              }
            </div>
            <p class="text-sm font-medium text-gray-800 dark:text-white leading-tight line-clamp-2">
              {{ combo.name }}
            </p>
            <p class="text-xs font-semibold text-brand-600 dark:text-brand-400 mt-1">
              @if (combo.pricingMode === 'FIXED') {
              {{ combo.comboPrice | number: '1.0-0' }}đ
              } @else {
              Giá linh hoạt
              }
            </p>
          </button>
          }
        </div>
        @if (filteredCombos.length === 0) {
        <div class="flex flex-col items-center justify-center h-64 text-gray-400">
          <svg class="w-12 h-12 mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4">
            </path>
          </svg>
          <p>Không tìm thấy combo nào.</p>
        </div>
        }
        }

        @else {
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
          @for (product of filteredProducts; track product.id) {
          <button type="button"
            class="flex flex-col items-center justify-between p-3 text-center rounded-lg shadow bg-white dark:bg-gray-800 hover:shadow-md hover:scale-[1.02] transition-all duration-150 border border-transparent hover:border-brand-200"
            (click)="onProductClick(product)">
            <div class="w-full h-24 mb-2 bg-gray-100 rounded dark:bg-gray-700 overflow-hidden">
              @if (product.image) {
              <img [src]="product.image" [alt]="product.name" class="w-full h-full object-cover" />
              } @else {
              <div class="flex items-center justify-center w-full h-full text-gray-400">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l-1-1m6 0h.01M5 12v-4a2 2 0 012-2h10a2 2 0 012 2v4M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2H5z">
                  </path>
                </svg>
              </div>
              }
            </div>
            <p class="text-sm font-medium text-gray-800 dark:text-white leading-tight line-clamp-2">
              {{ product.name }}
            </p>
            <p class="text-xs font-semibold text-brand-600 dark:text-brand-400 mt-1">
              {{ product.basePrice | number: '1.0-0' }}đ
            </p>
          </button>
          }
        </div>
        @if (filteredProducts.length === 0) {
        <div class="flex flex-col items-center justify-center h-64 text-gray-400">
          <svg class="w-12 h-12 mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <p>Không tìm thấy sản phẩm trong danh mục này.</p>
        </div>
        }
        }

      </div>
    </div>
  </div>
</div>