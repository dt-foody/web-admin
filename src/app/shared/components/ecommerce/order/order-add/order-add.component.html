<div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
  <!-- BÊN TRÁI: THÔNG TIN KHÁCH HÀNG + SẢN PHẨM -->
  <div class="space-y-6 lg:col-span-2">
    <!-- Thông tin khách hàng -->
    <div
      class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"
    >
      <div class="border-b border-gray-200 px-6 py-4 dark:border-gray-800">
        <h2 class="text-lg font-medium text-gray-800 dark:text-white">Thông Tin Khách Hàng</h2>
      </div>

      <div class="p-4 sm:p-6">
        <div class="space-y-5">
          <!-- Khách hàng -->
          <div>
            <app-label for="customer">Khách Hàng</app-label>
            <ng-select
              [items]="customers"
              bindLabel="name"
              bindValue="id"
              placeholder="Chọn khách hàng (hoặc để trống cho khách vãng lai)"
              [(ngModel)]="orderData.profile"
              (ngModelChange)="onCustomerChange($event || '')"
              [searchable]="true"
              [clearable]="true"
              name="customer"
            >
              <ng-template ng-option-tmp let-item="item">
                <div class="flex flex-col">
                  <span class="font-medium">{{ item.name }}</span>
                  @if (item.phones && item.phones.length > 0) {
                    <span class="text-xs text-gray-500">
                      {{ item.phones[0].value }}
                    </span>
                  } @else if (item.emails && item.emails.length > 0) {
                    <span class="text-xs text-gray-500">
                      {{ item.emails[0].value }}
                    </span>
                  }
                </div>
              </ng-template>

              <ng-template ng-label-tmp let-item="item">
                <span class="font-medium">{{ item.name }}</span>
              </ng-template>
            </ng-select>
          </div>

          <!-- Loại đơn & kênh -->
          <div class="grid grid-cols-1 gap-5 md:grid-cols-2">
            <div>
              <app-label for="order-type" className="required"> Loại Đơn Hàng </app-label>
              <ng-select
                [items]="orderTypeOptions"
                bindLabel="label"
                bindValue="value"
                placeholder="Chọn loại đơn hàng"
                [(ngModel)]="orderData.orderType"
                (ngModelChange)="onOrderTypeChange($event)"
                [searchable]="false"
                [clearable]="false"
                name="orderType"
              >
              </ng-select>
            </div>

            <div>
              <app-label for="order-channel" className="required"> Kênh Đơn Hàng </app-label>
              <ng-select
                [items]="channelOptions"
                bindLabel="label"
                bindValue="value"
                placeholder="Chọn kênh đơn hàng"
                [(ngModel)]="orderData.channel"
                [searchable]="false"
                [clearable]="false"
                name="orderChannel"
              >
              </ng-select>
            </div>
          </div>

          <!-- Trạng thái + note -->
          <div class="grid grid-cols-1 gap-5 md:grid-cols-2">
            <div>
              <app-label for="order-status">Trạng Thái Đơn Hàng</app-label>
              <ng-select
                [items]="orderStatuses"
                bindLabel="label"
                bindValue="value"
                [(ngModel)]="orderData.status"
                [searchable]="false"
                [clearable]="false"
                name="orderStatuses"
              >
              </ng-select>
            </div>

            <div>
              <app-label for="order-note">Ghi Chú Đơn Hàng</app-label>
              <app-input-field
                id="order-note"
                placeholder="Nhập ghi chú cho đơn hàng"
                [(value)]="orderData.note"
              ></app-input-field>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sản phẩm trong đơn -->
    <div
      class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"
    >
      <div class="border-b border-gray-200 px-6 py-4 dark:border-gray-800">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-medium text-gray-800 dark:text-white">Sản Phẩm</h2>

          <app-button
            variant="outline"
            size="sm"
            (btnClick)="addOrderItem()"
            [disabled]="editModeType === 'metaOnly'"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="mr-1.5"
            >
              <path d="M12 5v14M5 12h14" />
            </svg>
            Thêm Sản Phẩm
          </app-button>
        </div>
      </div>

      <div class="p-4 sm:p-6" [class.opacity-60]="editModeType === 'metaOnly'">
        <div class="space-y-4">
          @if (orderData.items.length === 0) {
            <div
              class="rounded-lg border-2 border-dashed border-gray-300 p-12 text-center dark:border-gray-700"
            >
              <p class="mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">
                Chưa có sản phẩm nào trong đơn
              </p>
              <app-button
                variant="primary"
                size="sm"
                (btnClick)="addOrderItem()"
                [disabled]="editModeType === 'metaOnly'"
              >
                Thêm Sản Phẩm Đầu Tiên
              </app-button>
            </div>
          }

          @for (item of orderData.items; let i = $index; track $index) {
            <div
              class="rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-900/50"
            >
              <div class="space-y-4">
                <!-- Tiêu đề hàng -->
                <div class="flex items-center justify-between">
                  <div class="flex flex-wrap items-center gap-3">
                    <label class="inline-flex items-center">
                      <input
                        type="radio"
                        [name]="'itemType-' + i"
                        [value]="'product'"
                        [checked]="getItemType(i) === 'product'"
                        (change)="onItemTypeChange(i, 'product')"
                        class="h-4 w-4 border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500"
                        [disabled]="editModeType === 'metaOnly'"
                      />
                      <span class="ml-2 text-sm text-gray-700 dark:text-gray-300"> Sản Phẩm </span>
                    </label>

                    <label class="inline-flex items-center">
                      <input
                        type="radio"
                        [name]="'itemType-' + i"
                        [value]="'combo'"
                        [checked]="getItemType(i) === 'combo'"
                        (change)="onItemTypeChange(i, 'combo')"
                        class="h-4 w-4 border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500"
                        [disabled]="editModeType === 'metaOnly'"
                      />
                      <span class="ml-2 text-sm text-gray-700 dark:text-gray-300"> Combo </span>
                    </label>

                    @if (!isItemExpanded(i) && item.name) {
                      <span
                        class="ml-2 hidden text-sm font-medium text-gray-800 dark:text-gray-200 md:inline"
                      >
                        {{ item.quantity }} x {{ item.name }}
                      </span>
                    }
                  </div>

                  <div class="flex items-center gap-2">
                    <button
                      type="button"
                      (click)="toggleItemExpansion(i)"
                      class="rounded p-2 text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800"
                      [attr.aria-expanded]="isItemExpanded(i)"
                      [title]="isItemExpanded(i) ? 'Thu gọn' : 'Mở rộng'"
                    >
                      @if (isItemExpanded(i)) {
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="20"
                          height="20"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path d="m18 15-6-6-6 6" />
                        </svg>
                      } @else {
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="20"
                          height="20"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        >
                          <path d="m6 9 6 6 6-6" />
                        </svg>
                      }
                    </button>

                    <button
                      (click)="removeOrderItem(i)"
                      class="rounded p-2 text-red-500 hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20"
                      title="Xóa Sản Phẩm"
                      [disabled]="editModeType === 'metaOnly'"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <path
                          d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                        />
                      </svg>
                    </button>
                  </div>
                </div>

                <!-- Chi tiết sản phẩm / combo -->
                @if (isItemExpanded(i)) {
                  <div class="space-y-4 border-t border-gray-200 pt-4 dark:border-gray-700">
                    @let type = getItemType(i);

                    <!-- Nếu là PRODUCT -->
                    @if (type === 'product') {
                      <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
                        <div class="md:col-span-2 space-y-3">
                          <!-- chọn product -->
                          <div>
                            <app-label className="required"> Chọn Sản Phẩm </app-label>
                            <ng-select
                              [items]="products"
                              bindLabel="name"
                              bindValue="id"
                              placeholder="Chọn sản phẩm"
                              [(ngModel)]="orderData.items[i].item"
                              (ngModelChange)="onProductChange(i, $event)"
                              [searchable]="true"
                              [clearable]="true"
                              [disabled]="editModeType === 'metaOnly'"
                              name="itemProduct-{{ i }}"
                            >
                              <ng-template ng-option-tmp let-prod="item">
                                <div class="flex flex-col">
                                  <span class="font-medium">{{ prod.name }}</span>
                                  @if (prod.basePrice) {
                                    <span class="text-xs text-gray-500">
                                      {{ prod.basePrice | number: '1.0-0' }} đ
                                    </span>
                                  }
                                </div>
                              </ng-template>
                            </ng-select>
                          </div>

                          <!-- Options sản phẩm -->
                          @let product = getProduct(item.item);
                          @if (product && product.optionGroups && product.optionGroups.length > 0) {
                            <div class="space-y-3">
                              <div class="text-sm font-medium text-gray-700 dark:text-gray-300">
                                Tuỳ Chọn Sản Phẩm
                              </div>

                              @for (group of product.optionGroups; track group.name) {
                                <div class="rounded-md bg-white p-3 shadow-sm dark:bg-gray-900/60">
                                  <div class="mb-2 flex items-center justify-between">
                                    <div>
                                      <div
                                        class="text-sm font-semibold text-gray-800 dark:text-gray-100"
                                      >
                                        {{ group.name }}
                                      </div>
                                      <div class="text-xs text-gray-500 dark:text-gray-400">
                                        Bắt buộc: {{ group.minOptions }} - Tối đa:
                                        {{ group.maxOptions }}
                                      </div>
                                    </div>
                                  </div>

                                  <div class="space-y-2">
                                    @for (opt of group.options; track opt.name) {
                                      <label
                                        class="flex cursor-pointer items-center justify-between rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm hover:bg-gray-100 dark:border-gray-700 dark:bg-gray-900/70 dark:hover:bg-gray-900"
                                      >
                                        <div class="flex items-center gap-2">
                                          <input
                                            [type]="group.maxOptions === 1 ? 'radio' : 'checkbox'"
                                            class="h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500"
                                            [name]="
                                              'product-opt-' +
                                              i +
                                              '-' +
                                              group.name.replace(' ', '-')
                                            "
                                            [checked]="
                                              isProductOptionSelected(item, group.name, opt.name)
                                            "
                                            (change)="toggleProductOption(i, group, opt, $event)"
                                            [disabled]="editModeType === 'metaOnly'"
                                          />
                                          <span
                                            class="font-medium text-gray-800 dark:text-gray-100"
                                          >
                                            {{ opt.name }}
                                          </span>
                                        </div>
                                        <span
                                          class="text-xs font-medium text-gray-600 dark:text-gray-300"
                                        >
                                          @if (opt.type === 'percentage') {
                                            +{{ opt.priceModifier }}%
                                          } @else {
                                            +{{ opt.priceModifier | number: '1.0-0' }} đ
                                          }
                                        </span>
                                      </label>
                                    }
                                  </div>
                                </div>
                              }
                            </div>
                          }
                        </div>

                        <!-- Qty + Price + Note -->
                        <div class="space-y-3">
                          <div>
                            <app-label className="required">Số Lượng</app-label>
                            <app-input-field
                              type="number"
                              min="1"
                              [(value)]="orderData.items[i].quantity"
                              (valueChange)="onItemQuantityChange(i, $event)"
                              placeholder="1"
                              [disabled]="editModeType === 'metaOnly'"
                            ></app-input-field>
                          </div>

                          <div>
                            <app-label>Giá (override)</app-label>
                            <app-input-field
                              type="number"
                              [(value)]="orderData.items[i].price"
                              (valueChange)="onItemPriceOverride(i, $event)"
                              placeholder="Tự nhập để override"
                              [disabled]="editModeType === 'metaOnly'"
                            ></app-input-field>
                            <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                              Để trống nếu muốn dùng giá + options mặc định.
                            </p>
                          </div>

                          <div>
                            <app-label>Ghi chú món</app-label>
                            <app-input-field
                              [(value)]="orderData.items[i].note"
                              placeholder="Ví dụ: ít đá, bớt ngọt..."
                            ></app-input-field>
                          </div>

                          <div
                            class="mt-2 rounded-md bg-blue-50 px-3 py-2 text-sm font-semibold text-blue-700 dark:bg-blue-900/30 dark:text-blue-200"
                          >
                            Thành tiền:
                            {{ (item.price || 0) * (item.quantity || 0) | number: '1.0-0' }}
                            đ
                          </div>
                        </div>
                      </div>
                    }

                    <!-- Nếu là COMBO -->
                    @if (type === 'combo') {
                      <div class="space-y-4">
                        <!-- Chọn Combo -->
                        <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
                          <div class="md:col-span-2">
                            <app-label className="required"> Chọn Combo </app-label>
                            <ng-select
                              [items]="combos"
                              bindLabel="name"
                              bindValue="id"
                              placeholder="Chọn combo"
                              [(ngModel)]="orderData.items[i].item"
                              (ngModelChange)="onComboChange(i, $event)"
                              [searchable]="true"
                              [clearable]="true"
                              [disabled]="editModeType === 'metaOnly'"
                              name="itemCombo-{{ i }}"
                            >
                              <ng-template ng-option-tmp let-combo="item">
                                <div class="flex flex-col">
                                  <span class="font-medium">
                                    {{ combo.name }}
                                  </span>
                                  @if (combo.pricingMode === PricingMode.FIXED) {
                                    <span class="text-xs text-gray-500">
                                      Giá combo:
                                      {{ combo.comboPrice | number: '1.0-0' }}
                                      đ
                                    </span>
                                  } @else if (combo.pricingMode === PricingMode.SLOT_PRICE) {
                                    <span class="text-xs text-gray-500">
                                      Tính theo giá từng slot
                                    </span>
                                  } @else if (combo.pricingMode === PricingMode.DISCOUNT) {
                                    <span class="text-xs text-gray-500">
                                      Giảm giá:
                                      {{ combo.discountValue }}
                                      {{ combo.discountType === 'PERCENT' ? '%' : 'đ' }}
                                    </span>
                                  }
                                </div>
                              </ng-template>
                            </ng-select>
                          </div>

                          <div class="space-y-3">
                            <div>
                              <app-label className="required"> Số Lượng </app-label>
                              <app-input-field
                                type="number"
                                min="1"
                                [(value)]="orderData.items[i].quantity"
                                (valueChange)="onItemQuantityChange(i, $event)"
                                placeholder="1"
                                [disabled]="editModeType === 'metaOnly'"
                              ></app-input-field>
                            </div>

                            <div>
                              <app-label>Ghi chú combo</app-label>
                              <app-input-field
                                [(value)]="orderData.items[i].note"
                                placeholder="Ví dụ: ít đá, bớt ngọt..."
                              ></app-input-field>
                            </div>

                            <div
                              class="mt-2 rounded-md bg-blue-50 px-3 py-2 text-sm font-semibold text-blue-700 dark:bg-blue-900/30 dark:text-blue-200"
                            >
                              Thành tiền:
                              {{ (item.price || 0) * (item.quantity || 0) | number: '1.0-0' }}
                              đ
                            </div>
                          </div>
                        </div>

                        <!-- Slot trong combo -->
                        @let combo = getCombo(item.item);

                        @if (combo) {
                          <div class="space-y-4">
                            @for (slot of combo.items; track slot.slotName) {
                              <div class="rounded-md bg-white p-3 shadow-sm dark:bg-gray-900/60">
                                <div class="mb-2 flex items-center justify-between">
                                  <div>
                                    <div
                                      class="text-sm font-semibold text-gray-800 dark:text-gray-100"
                                    >
                                      Slot: {{ slot.slotName }}
                                    </div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">
                                      Chọn:
                                      {{ slot.minSelection }} - {{ slot.maxSelection }}
                                      sản phẩm
                                    </div>
                                  </div>
                                </div>

                                <!-- Chọn product cho slot -->
                                <div class="mb-3">
                                  @let selectedId = getComboSlotSelection(item, slot.slotName);
                                  <ng-select
                                    [items]="slot.selectableProducts"
                                    [searchable]="true"
                                    [clearable]="false"
                                    [disabled]="editModeType === 'metaOnly'"
                                    [bindLabel]="'product.name'"
                                    [bindValue]="'product.id'"
                                    [ngModel]="selectedId"
                                    (ngModelChange)="onComboProductChange(i, slot, $event)"
                                    name="comboSlot-{{ i }}-{{ slot.slotName }}"
                                  >
                                    <ng-template ng-option-tmp let-sp="item">
                                      <div class="flex flex-col">
                                        <span class="font-medium">
                                          {{ sp.product?.name }}
                                        </span>
                                        <span class="text-xs text-gray-500">
                                          Base:
                                          {{ sp.snapshotPrice | number: '1.0-0' }}
                                          đ
                                          @if (sp.additionalPrice) {
                                            • Thêm:
                                            {{ sp.additionalPrice | number: '1.0-0' }}
                                            đ
                                          }
                                          @if (sp.slotPrice) {
                                            • Slot:
                                            {{ sp.slotPrice | number: '1.0-0' }}
                                            đ
                                          }
                                        </span>
                                      </div>
                                    </ng-template>
                                  </ng-select>
                                </div>

                                <!-- Options cho product trong combo -->
                                @let selection = getComboSelectionForSlot(item, slot.slotName);
                                @let selProd = getComboSelectionProduct(combo, selection);

                                @if (
                                  selection &&
                                  selProd &&
                                  selProd.optionGroups &&
                                  selProd.optionGroups.length > 0
                                ) {
                                  <div class="space-y-3">
                                    @for (group of selProd.optionGroups; track group.name) {
                                      <div class="rounded-md bg-gray-50 p-3 dark:bg-gray-900/80">
                                        <div
                                          class="mb-2 text-sm font-semibold text-gray-800 dark:text-gray-100"
                                        >
                                          {{ group.name }}
                                          <span
                                            class="ml-1 text-xs font-normal text-gray-500 dark:text-gray-400"
                                          >
                                            (Bắt buộc: {{ group.minOptions }} - Tối đa:
                                            {{ group.maxOptions }})
                                          </span>
                                        </div>

                                        <div class="space-y-2">
                                          @for (opt of group.options; track opt.name) {
                                            <label
                                              class="flex cursor-pointer items-center justify-between rounded-md border border-gray-200 bg-white px-3 py-2 text-sm hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-900 dark:hover:bg-gray-800"
                                            >
                                              <div class="flex items-center gap-2">
                                                <input
                                                  [type]="
                                                    group.maxOptions === 1 ? 'radio' : 'checkbox'
                                                  "
                                                  class="h-4 w-4 border-gray-300 text-blue-600 focus:ring-blue-500"
                                                  [name]="
                                                    'combo-opt-' +
                                                    i +
                                                    '-' +
                                                    slot.slotName +
                                                    '-' +
                                                    group.name.replace(' ', '-')
                                                  "
                                                  [checked]="
                                                    isComboOptionSelected(
                                                      selection,
                                                      group.name,
                                                      opt.name
                                                    )
                                                  "
                                                  (change)="
                                                    toggleComboOption(
                                                      i,
                                                      selection,
                                                      group,
                                                      opt,
                                                      $event
                                                    )
                                                  "
                                                  [disabled]="editModeType === 'metaOnly'"
                                                />
                                                <span
                                                  class="font-medium text-gray-800 dark:text-gray-100"
                                                >
                                                  {{ opt.name }}
                                                </span>
                                              </div>
                                              <span
                                                class="text-xs font-medium text-gray-600 dark:text-gray-300"
                                              >
                                                @if (opt.type === 'percentage') {
                                                  +{{ opt.priceModifier }}%
                                                } @else {
                                                  +{{ opt.priceModifier | number: '1.0-0' }}
                                                  đ
                                                }
                                              </span>
                                            </label>
                                          }
                                        </div>
                                      </div>
                                    }
                                  </div>
                                }
                              </div>
                            }
                          </div>
                        }
                      </div>
                    }
                  </div>
                }
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- BÊN PHẢI: TÓM TẮT + THANH TOÁN + GIAO HÀNG -->
  <div class="space-y-6 lg:col-span-1">
    <div class="sticky top-6 space-y-6">
      <!-- Tóm tắt giá -->
      <div
        class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"
      >
        <div class="border-b border-gray-200 px-6 py-4 dark:border-gray-800">
          <h2 class="text-lg font-medium text-gray-800 dark:text-white">Tóm Tắt</h2>
        </div>

        <div class="p-4 sm:p-6">
          <div class="space-y-4">
            <div
              class="flex items-center justify-between rounded-lg bg-gray-50 p-4 dark:bg-gray-900/50"
            >
              <span class="text-sm font-medium text-gray-700 dark:text-gray-300"> Tổng Tiền </span>
              <span class="text-lg font-semibold text-gray-800 dark:text-white">
                {{ orderData.totalAmount | number: '1.0-0' }} đ
              </span>
            </div>

            <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
              <div>
                <app-label for="discount-type">Loại Giảm Giá</app-label>
                <ng-select
                  [items]="discountTypeOptions"
                  bindLabel="label"
                  bindValue="value"
                  [(ngModel)]="orderData.discountType"
                  (ngModelChange)="calculateTotals()"
                  [searchable]="false"
                  [clearable]="false"
                  name="discountType"
                  [disabled]="editModeType === 'metaOnly'"
                >
                </ng-select>
              </div>

              <div>
                <app-label for="discount-value">Giá Trị Giảm Giá</app-label>
                <app-input-field
                  id="discount-value"
                  type="number"
                  placeholder="0"
                  [(value)]="orderData.discountValue"
                  (valueChange)="calculateTotals()"
                  [disabled]="editModeType === 'metaOnly'"
                ></app-input-field>
              </div>
            </div>

            <div>
              <app-label for="shipping-fee">Phí Vận Chuyển</app-label>
              <app-input-field
                id="shipping-fee"
                type="number"
                placeholder="0"
                [(value)]="orderData.shippingFee"
                (valueChange)="calculateTotals()"
                [disabled]="orderData.orderType !== 'Delivery' || editModeType === 'metaOnly'"
              ></app-input-field>
            </div>

            <div
              class="flex items-center justify-between rounded-lg bg-blue-50 p-4 dark:bg-blue-900/20"
            >
              <span class="text-base font-semibold text-blue-700 dark:text-blue-300">
                Tổng Cộng
              </span>
              <span class="text-2xl font-bold text-blue-700 dark:text-blue-300">
                {{ orderData.grandTotal | number: '1.0-0' }} đ
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Thông tin thanh toán -->
      <div
        class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"
      >
        <div class="border-b border-gray-200 px-6 py-4 dark:border-gray-800">
          <h2 class="text-lg font-medium text-gray-800 dark:text-white">Thông Tin Thanh Toán</h2>
        </div>

        <div class="p-4 sm:p-6">
          <div class="grid grid-cols-1 gap-5 md:grid-cols-2">
            <div>
              <app-label for="payment-method">Phương Thức</app-label>
              <ng-select
                [items]="paymentMethods"
                bindLabel="label"
                bindValue="value"
                [(ngModel)]="orderData.payment.method"
                [searchable]="false"
                [clearable]="false"
                name="paymentMethod"
              >
              </ng-select>
            </div>

            <div>
              <app-label for="payment-status">Trạng Thái</app-label>
              <ng-select
                [items]="paymentStatuses"
                bindLabel="label"
                bindValue="value"
                [(ngModel)]="orderData.payment.status"
                [searchable]="false"
                [clearable]="false"
                name="paymentStatus"
              >
              </ng-select>
            </div>
          </div>
        </div>
      </div>

      <!-- Thông tin giao hàng -->
      @if (orderData.orderType === 'Delivery') {
        <div
          class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"
        >
          <div class="border-b border-gray-200 px-6 py-4 dark:border-gray-800">
            <h2 class="text-lg font-medium text-gray-800 dark:text-white">Thông Tin Giao Hàng</h2>
          </div>

          <div class="p-4 sm:p-6 space-y-4">
            <!-- Chọn địa chỉ trong customer -->
            <div>
              <app-label>Địa chỉ đã lưu</app-label>
              <ng-select
                [items]="shippingAddressOptions"
                bindLabel="label"
                bindValue="id"
                [(ngModel)]="selectedShippingAddressId"
                (ngModelChange)="onShippingAddressChange($event)"
                [searchable]="false"
                [clearable]="false"
                name="shippingAddressSelect"
              >
              </ng-select>
            </div>

            <!-- Form địa chỉ -->
            <div class="grid grid-cols-1 gap-4">
              <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                <div>
                  <app-label className="required"> Tên Người Nhận </app-label>
                  <app-input-field
                    [(value)]="orderData.shipping!.address.recipientName"
                    placeholder="Nguyễn Văn A"
                  ></app-input-field>
                </div>
                <div>
                  <app-label className="required"> Số Điện Thoại </app-label>
                  <app-input-field
                    [(value)]="orderData.shipping!.address.recipientPhone"
                    placeholder="09xxxxxxxx"
                  ></app-input-field>
                </div>
              </div>

              <div>
                <app-label className="required"> Địa Chỉ (Đường / Số nhà) </app-label>
                <app-input-field
                  [(value)]="orderData.shipping!.address.street"
                  placeholder="Số nhà, tên đường..."
                ></app-input-field>
              </div>

              <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
                <div>
                  <app-label>Phường/Xã</app-label>
                  <app-input-field
                    [(value)]="orderData.shipping!.address.ward"
                    placeholder="Phường/Xã"
                  ></app-input-field>
                </div>

                <div>
                  <app-label>Quận/Huyện</app-label>
                  <app-input-field
                    [(value)]="orderData.shipping!.address.district"
                    placeholder="Quận/Huyện"
                  ></app-input-field>
                </div>

                <div>
                  <app-label className="required"> Thành Phố </app-label>
                  <app-input-field
                    [(value)]="orderData.shipping!.address.city"
                    placeholder="Thành phố"
                  ></app-input-field>
                </div>
              </div>

              <div>
                <app-label>Trạng Thái Giao Hàng</app-label>
                <ng-select
                  [items]="shippingStatuses"
                  bindLabel="label"
                  bindValue="value"
                  [(ngModel)]="orderData.shipping!.status"
                  [searchable]="false"
                  [clearable]="false"
                  name="shippingStatus"
                >
                </ng-select>
              </div>
            </div>
          </div>
        </div>
      }

      <!-- Hành động -->
      <div class="flex gap-4">
        <!-- <div class="flex gap-4">
          <app-button variant="outline" (btnClick)="onSaveDraft()" class="w-full flex-1" className="w-full">
            Lưu Nháp
          </app-button>
          <app-button variant="primary" (btnClick)="onSubmit()" class="w-full flex-1" className="w-full">
            {{ isEditMode ? 'Cập Nhật Đơn Hàng' : 'Tạo Đơn Hàng' }}
          </app-button>
        </div> -->

        <button
          type="button"
          class="inline-flex w-full items-center justify-center gap-2 rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 flex-1"
          (click)="router.navigateByUrl('/order')"
        >
          Hủy
        </button>
        <app-button
          variant="primary"
          (btnClick)="onSubmit()"
          class="w-full flex-2"
          className="w-full"
        >
          {{ isEditMode ? 'Cập Nhật Đơn Hàng' : 'Tạo Đơn Hàng' }}
        </app-button>
      </div>
    </div>
  </div>
</div>
